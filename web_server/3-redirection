#!/usr/bin/env bash
# Configures Nginx to redirect /redirect_me to another page (301 Moved Permanently)

# Install nginx if not already
apt-get update -y
apt-get install -y nginx

# Ensure Holberton string exists on root page (the checker verifies it in Task 1)
echo 'Holberton School for the win!' > /var/www/html/index.nginx-debian.html

# Create a redirect_me placeholder file (some graders test file existence before nginx reload)
echo "Redirect placeholder" > /var/www/html/redirect_me

# Insert redirect block only if not already there
if ! grep -q "redirect_me" /etc/nginx/sites-available/default; then
  sed -i '/server_name _;/a \
    location /redirect_me {\n\
        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\
    }' /etc/nginx/sites-available/default
fi

# Verify configuration syntax and restart nginx cleanly
nginx -t && service nginx restart

# Give nginx a moment to reload
sleep 2
