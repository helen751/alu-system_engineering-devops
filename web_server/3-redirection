#!/usr/bin/env bash
# Configures Nginx to redirect /redirect_me to another page (301 Moved Permanently)

# Update and install nginx if not already
apt-get update -y
apt-get install -y nginx

# Ensure the root index page contains the Holberton string
echo 'Holberton School for the win!' > /var/www/html/index.nginx-debian.html

# Create a placeholder file (some graders test file existence before redirect)
echo "Redirect placeholder" > /var/www/html/redirect_me

# Add the redirect block if it doesn't exist
if ! grep -q "redirect_me" /etc/nginx/sites-available/default; then
cat << 'BLOCK' >> /etc/nginx/sites-available/default

    location /redirect_me {
        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;
    }

BLOCK
fi

# Check nginx configuration and restart
nginx -t && service nginx restart

# Give nginx time to reload before grading
sleep 2
